<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wpf | 易陽羽博客平台</title>
    <meta name="description" content="易陽羽博客平台">
    <link rel="icon" href="/images/test.jpg">
  <link rel="manifest" href="/images/test.jpg">
  <link rel="apple-touch-icon" href="/images/test.jpg">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
  <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.c9120bc4.css" as="style"><link rel="preload" href="/assets/js/app.4da30dd0.js" as="script"><link rel="preload" href="/assets/js/10.cfc7b205.js" as="script"><link rel="prefetch" href="/assets/js/11.cb8ae4bc.js"><link rel="prefetch" href="/assets/js/12.ab3ecb05.js"><link rel="prefetch" href="/assets/js/13.86f17a9a.js"><link rel="prefetch" href="/assets/js/14.ded0f1b1.js"><link rel="prefetch" href="/assets/js/15.86569fc0.js"><link rel="prefetch" href="/assets/js/16.38bf9bf2.js"><link rel="prefetch" href="/assets/js/2.33d9b4c1.js"><link rel="prefetch" href="/assets/js/3.b0ae39a2.js"><link rel="prefetch" href="/assets/js/4.a57a78a9.js"><link rel="prefetch" href="/assets/js/5.11d7f905.js"><link rel="prefetch" href="/assets/js/6.adf1cbb1.js"><link rel="prefetch" href="/assets/js/7.1581cf2f.js"><link rel="prefetch" href="/assets/js/8.3ca4c508.js"><link rel="prefetch" href="/assets/js/9.93f8b21b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9120bc4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">易陽羽博客平台</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link">JAVA知识</a></div><div class="nav-item"><a href="/others/" class="nav-link">前端开发</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link router-link-active">Dotnet软件开发</a></div><div class="nav-item"><a href="/others/" class="nav-link">机器视觉开发</a></div><div class="nav-item"><a href="/others/" class="nav-link">上位机开发</a></div><div class="nav-item"><a href="https://www.cnblogs.com/yiyangyu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  易陽羽
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link">JAVA知识</a></div><div class="nav-item"><a href="/others/" class="nav-link">前端开发</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link router-link-active">Dotnet软件开发</a></div><div class="nav-item"><a href="/others/" class="nav-link">机器视觉开发</a></div><div class="nav-item"><a href="/others/" class="nav-link">上位机开发</a></div><div class="nav-item"><a href="https://www.cnblogs.com/yiyangyu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  易陽羽
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>wpf</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="wpf"><a href="#wpf" class="header-anchor">#</a> wpf</h1> <ul><li>用wpf 加载显示图像，并通过鼠标悬浮时获取图像的像素坐标以及灰度，同时包含图像缩放功能，还有上下文菜单功能</li></ul> <p>以下是使用WPF加载和显示图像，并通过鼠标悬浮获取图像的像素坐标和灰度值的一些示例代码：</p> <p>XAML 布局：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;Window x:Class=&quot;ImageProcessing.MainWindow&quot;
        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
        Title=&quot;MainWindow&quot; Height=&quot;450&quot; Width=&quot;800&quot;&gt;
    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height=&quot;Auto&quot;/&gt;
            &lt;RowDefinition Height=&quot;*&quot;/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- 菜单 --&gt;
        &lt;Menu&gt;
            &lt;MenuItem Header=&quot;_File&quot;&gt;
                &lt;MenuItem Header=&quot;_Open&quot; Click=&quot;Open_Click&quot;/&gt;
                &lt;Separator/&gt;
                &lt;MenuItem Header=&quot;_Exit&quot; Click=&quot;Exit_Click&quot;/&gt;
            &lt;/MenuItem&gt;
            &lt;MenuItem Header=&quot;_Options&quot;&gt;
                &lt;MenuItem Header=&quot;_Zoom In&quot; Click=&quot;ZoomIn_Click&quot;/&gt;
                &lt;MenuItem Header=&quot;_Zoom Out&quot; Click=&quot;ZoomOut_Click&quot;/&gt;
            &lt;/MenuItem&gt;
        &lt;/Menu&gt;

        &lt;!-- 显示图像的控件 --&gt;
        &lt;Image Name=&quot;image&quot; Grid.Row=&quot;1&quot; 
               Stretch=&quot;None&quot; MouseMove=&quot;Image_MouseMove&quot;/&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>C# 代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;
using Microsoft.Win32;
using System.IO;

namespace ImageProcessing
{
    public partial class MainWindow : Window
    {
        private BitmapSource bitmapSource; // 加载的位图
        private double zoomFactor = 1.0; // 缩放系数

        public MainWindow()
        {
            InitializeComponent();
        }

        // 打开文件并显示图像
        private void Open_Click(object sender, RoutedEventArgs e)
        {
            OpenFileDialog openFileDialog = new OpenFileDialog();
            if (openFileDialog.ShowDialog() == true)
            {
                byte[] bytes = File.ReadAllBytes(openFileDialog.FileName);
                MemoryStream ms = new MemoryStream(bytes);
                bitmapSource = BitmapFrame.Create(ms);
                image.Source = bitmapSource;
            }
        }

        // 退出应用程序
        private void Exit_Click(object sender, RoutedEventArgs e)
        {
            Application.Current.Shutdown();
        }

        // 图像缩小
        private void ZoomOut_Click(object sender, RoutedEventArgs e)
        {
            zoomFactor /= 2;
            ScaleTransform scaleTransform = new ScaleTransform(zoomFactor, zoomFactor);
            image.LayoutTransform = scaleTransform;
        }

        // 图像放大
        private void ZoomIn_Click(object sender, RoutedEventArgs e)
        {
            zoomFactor *= 2;
            ScaleTransform scaleTransform = new ScaleTransform(zoomFactor, zoomFactor);
            image.LayoutTransform = scaleTransform;
        }

        // 获取鼠标悬浮的像素坐标和灰度值
        private void Image_MouseMove(object sender, MouseEventArgs e)
        {
            Point point = e.GetPosition(image);
            int x = (int)(point.X / zoomFactor);
            int y = (int)(point.Y / zoomFactor);
            if (bitmapSource != null &amp;&amp; 
                x &gt;= 0 &amp;&amp; x &lt; bitmapSource.PixelWidth &amp;&amp; 
                y &gt;= 0 &amp;&amp; y &lt; bitmapSource.PixelHeight)
            {
                CroppedBitmap croppedBitmap = 
                    new CroppedBitmap(bitmapSource, new Int32Rect(x, y, 1, 1));
                byte[] pixels = new byte[4];
                croppedBitmap.CopyPixels(pixels, 4, 0);
                int grayScale = (pixels[0] + pixels[1] + pixels[2]) / 3;
                // 处理获取到的像素坐标和灰度值
            }
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><ul><li>此外，你可以使用WPF提供的ContextMenu类来实现上下文菜单功能。将ContextMenu对象添加到Image控件的ContextMenu属性即可。</li></ul> <h3 id="_1-2-用wpf开发加载一个图像，并在图像中心位置画出红色的十字架，状态栏显示图像类型，大小，像素坐标，灰度，位深的功能"><a href="#_1-2-用wpf开发加载一个图像，并在图像中心位置画出红色的十字架，状态栏显示图像类型，大小，像素坐标，灰度，位深的功能" class="header-anchor">#</a> 1.2 用wpf开发加载一个图像，并在图像中心位置画出红色的十字架，状态栏显示图像类型，大小，像素坐标，灰度，位深的功能</h3> <p>下面是使用WPF开发加载图像并在中心位置画出红色十字架，并在状态栏上显示有关图像的信息的示例代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xml复制代码&lt;Window x:Class=&quot;ImageInfo.MainWindow&quot;
        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
        Title=&quot;Image Information&quot; Height=&quot;350&quot; Width=&quot;525&quot;&gt;
    &lt;Grid&gt;
        &lt;Image x:Name=&quot;imgMain&quot; Stretch=&quot;Uniform&quot; VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
        &lt;Canvas x:Name=&quot;canvasCrosshair&quot; VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot;/&gt;
        &lt;StatusBar x:Name=&quot;statBar&quot; VerticalAlignment=&quot;Bottom&quot; Height=&quot;20&quot;&gt;
            &lt;StatusBarItem&gt;
                &lt;TextBlock x:Name=&quot;tbxImageInfo&quot; TextAlignment=&quot;Right&quot;/&gt;
            &lt;/StatusBarItem&gt;
        &lt;/StatusBar&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>首先，我们需要添加一个<code>Image</code>控件和一个<code>Canvas</code>控件。 <code>Image</code>用于显示图像，<code>Canvas</code>用于绘制十字架。</p> <p>接下来是代码的C#部分：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>csharp复制代码using System;
using System.Drawing;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;
using System.Windows.Media.Imaging;

namespace ImageInfo
{
    public partial class MainWindow : Window
    {
        private BitmapImage _imageSource;

        public MainWindow()
        {
            InitializeComponent();
            this.Loaded += MainWindow_Loaded;
        }

        private void MainWindow_Loaded(object sender, RoutedEventArgs e)
        {
            // TODO: Set image path
            string imagePath = &quot;&quot;;

            try
            {
                _imageSource = new BitmapImage(new Uri(imagePath));
                imgMain.Source = _imageSource;

                // Draw crosshair
                Line lineX = new Line
                {
                    X1 = 0,
                    Y1 = canvasCrosshair.ActualHeight / 2,
                    X2 = canvasCrosshair.ActualWidth,
                    Y2 = canvasCrosshair.ActualHeight / 2,
                    Stroke = Brushes.Red,
                    StrokeThickness = 2
                };

                Line lineY = new Line
                {
                    X1 = canvasCrosshair.ActualWidth / 2,
                    Y1 = canvasCrosshair.ActualHeight / 2,
                    X2 = canvasCrosshair.ActualWidth,
                    Y2 = canvasCrosshair.ActualHeight / 2,
                    Stroke = Brushes.Red,
                    StrokeThickness = 2
                };
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><ul><li>用wpf开发加载一个图像，并在图像中心位置画出红色的十字架，状态栏显示图像类型，大小，像素坐标，灰度，位深的软件</li></ul> <p>以下是使用WPF开发加载图像并在中心位置绘制红色十字架的代码示例，也包括状态栏显示图像元数据信息的实现：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>xml复制代码&lt;Window x:Class=&quot;ImageInfo.MainWindow&quot;
        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;
        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;
        Title=&quot;Image Information&quot; Width=&quot;600&quot; Height=&quot;600&quot; Loaded=&quot;Window_Loaded&quot;&gt;
    &lt;Grid&gt;
        &lt;StatusBar DockPanel.Dock=&quot;Bottom&quot;&gt;
            &lt;TextBlock x:Name=&quot;statusText&quot;/&gt;
        &lt;/StatusBar&gt;
        &lt;Canvas x:Name=&quot;canvas&quot; Background=&quot;White&quot;/&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在MainWindow.xaml.cs文件中可以添加以下代码，用于加载图像、计算图像元数据并在界面中绘制。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>csharp复制代码using System;
using System.Drawing;
using System.Drawing.Imaging;
using System.IO;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;
using System.Windows.Shapes;
using PixelFormat = System.Drawing.Imaging.PixelFormat;

public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }

    private void Window_Loaded(object sender, RoutedEventArgs e)
    {
        string imagePath = &quot;image.png&quot;;
        if (File.Exists(imagePath))
        {
            Image img = new Image();
            Bitmap bmp = new Bitmap(imagePath);
            
            // 计算图像元数据
            BitmapData data = bmp.LockBits(new Rectangle(0, 0, bmp.Width, bmp.Height), ImageLockMode.ReadOnly, bmp.PixelFormat);
            double pixelSize = GetPixelSize(bmp);
            string info = $&quot;{bmp.Width} x {bmp.Height}, {pixelSize.ToString(&quot;F2&quot;)} μm/pixel, {data.PixelFormat.ToString()}&quot;;
            bmp.UnlockBits(data);
            
            // 绘制图像和十字架
            img.Source = ConvertBitmapToImageSource(bmp);
            canvas.Children.Add(img);
            double centerX = canvas.ActualWidth / 2.0;
            double centerY = canvas.ActualHeight / 2.0;
            Line lineX = new Line();
            lineX.Stroke = Brushes.Red;
            lineX.X1 = centerX - 10;
            lineX.Y1 =
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><ul><li>整理一份can通信，modbus通信，tcp通信，http通信，mqtt,S7通信的功能实现</li></ul> <p>以下是 CAN 通信、Modbus 通信、TCP 通信、HTTP 通信、MQTT 和 S7 通信的功能实现说明：</p> <ol><li>CAN 通信：CAN（Controller Area Network）总线通信协议是一种广泛使用于汽车和工业控制领域的通信协议。CAN 通信需要通过 CAN 控制器芯片将数据发送到总线上，而接收方则需要使用相同的协议进行解析并处理数据。</li></ol> <p>在 CAN 通信中，需要编写与 CAN 控制器芯片通信的驱动程序，并设置相关参数（如位速率、过滤器等）。在数据发送时，需要将数据格式化为 CAN 数据帧并通过控制器进行传输；在接收数据时，需要对接收到的数据进行解析并提取需要的信息。</p> <ol><li>Modbus 通信：Modbus 是一种基于串行连接的协议，主要用于工业环境下的通信和控制。Modbus 协议包含多种传输方式，如 RTU（Remote Terminal Unit）、ASCII 等，其中 RTU 是最常用的方式。</li></ol> <p>在 Modbus 通信中，需要先建立连接（包括寻找从机、设定寻址方式、指定数据读写区域等），然后进行数据读写操作。对于 RTU 方式，还需要进行 CRC 校验以确保数据传输的正确性。</p> <ol><li>TCP 通信：TCP（Transmission Control Protocol）是基于连接的协议，用于实现可靠的数据传输。TCP 通信需要先建立连接，然后进行数据传输，最后再关闭连接。</li></ol> <p>在 TCP 通信中，需要编写服务器端和客户端程序，以实现双向的数据传输。服务器端需要等待客户端的连接请求，并响应相应的请求来建立起连接；而客户端则需要指定需要连接的服务器地址和端口号，以启动连接建立过程。在连接之后，就可以进行数据的读取和写入，当数据传输结束时，需要通过关闭连接来释放占用的资源。</p> <ol><li>HTTP 通信：HTTP（HyperText Transfer Protocol）是一种基于网络的协议，主要用于网页数据的传输。HTTP 请求和响应都是基于文本格式，采用 MIME 类型来确定数据类型。</li></ol> <p>在 HTTP 通信中，需要构造请求报文（包括请求方式、请求头部、请求主体等），并发送到服务器端；服务器接收到请求报文后，解析报文并生成响应报文（包括响应状态码、响应头部、响应主体等）发送回客户端。常见的 HTTP 请求方式包括 GET、POST、PUT、DELETE 等。</p> <ol><li>MQTT 通信：MQTT（Message Queuing Telemetry Transport）是一种轻量级的消息通信协议，适用于低能耗设备和不稳定网络环境。MQTT 协议采用发布/订阅模式，通过消息代理（Broker）来实现消息的转发和路由。</li></ol> <p>在 MQTT 通信中，需要编写客户端程序连接到指定的 Broker，并进行订阅或发布消息。当一个客户端发布一条消息时，Broker 会将该消息转发给所有订阅了该主题的其他客户端，以实现消息广播的效果。</p> <ol><li>S7 通信：S7（Simatic S7）是西门子公司开发的一种工业控制器，S7 通信协议主要用于与该控制器的通信。S7 通信采用基于 ISO-on-TCP 的协议，其中 ISO 协议是 OSI 参考模型中的数据链路层和物理层协议。</li></ol> <p>在 S7 通信中，需要编写本地通信模块和远程通信模块，并使用不同的协议号和数据区域来进行数据传输。具体地说，需要建立一个 TCP 连接，并发送特定格式的消息来请求数据读写操作；服务端收到请求后，返回相关的响应消息，以完成数据传输的过程。</p> <h3 id="用c-实现动态库类的成员，参数指针，参数结构体的导出，分别用java-jna调用接口，和c-调用接口"><a href="#用c-实现动态库类的成员，参数指针，参数结构体的导出，分别用java-jna调用接口，和c-调用接口" class="header-anchor">#</a> 用C++ 实现动态库类的成员，参数指针，参数结构体的导出，分别用JAVA jna调用接口，和C#调用接口</h3> <p>以下是用 C++ 实现动态库类的成员，参数指针，参数结构体的导出，并分别用 Java JNA 和 C# 调用接口的大致流程：</p> <ol><li>在 C++ 中实现动态库类的导出。可以使用 __declspec(dllexport) 关键字将类及其方法导出到动态库中，供其他程序调用。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>cppCopy Codestruct Point {
    int x;
    int y;
};

class __declspec(dllexport) MyClass {
public:
    void DoSomething();
    int Add(int a, int b);
    void Swap(int* pa, int* pb);
    void SetPoint(Point* p);
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol><li>将 C++ 动态库文件编译成 .dll 文件。可以使用 Visual Studio 或其他开发环境来生成 .dll 文件。</li> <li>使用 JNA 连接 C++ 动态库。可以使用 JNA 提供的 NativeLibrary 和 Function 类，通过动态链接库文件路径和方法名来调用 C++ 动态库中的方法。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>javaCopy CodeNativeLibrary lib = NativeLibrary.getInstance(&quot;MyDll.dll&quot;);
Function doSomethingFunc = lib.getFunction(&quot;DoSomething&quot;);
doSomethingFunc.invoke(new Object[0]);

Function addFunc = lib.getFunction(&quot;Add&quot;);
int result = (int)addFunc.invoke(Integer.class, new Object[] { 1, 2 });

Function swapFunc = lib.getFunction(&quot;Swap&quot;);
Pointer pa = new IntByReference(1).getPointer();
Pointer pb = new IntByReference(2).getPointer();
swapFunc.invoke(new Object[] { pa, pb });

Function setPointFunc = lib.getFunction(&quot;SetPoint&quot;);
Point point = new Point();
point.x = 100;
point.y = 200;
Structure struct = new Structure.ByValue(point);
setPointFunc.invoke(new Object[] { struct.getPointer() });
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol><li>在 C# 中使用 P/Invoke 进行调用。可以使用 DllImport 特性和 Marshal 类，通过动态链接库文件路径和方法名来调用 C++ 动态库中的方法。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>csharpCopy Codeclass Program {
    [DllImport(&quot;MyDll.dll&quot;)]
    public static extern void DoSomething();

    [DllImport(&quot;MyDll.dll&quot;)]
    public static extern int Add(int a, int b);

    [DllImport(&quot;MyDll.dll&quot;)]
    public static extern void Swap(ref int pa, ref int pb);

    [StructLayout(LayoutKind.Sequential)]
    public struct Point {
        public int x;
        public int y;
    }

    [DllImport(&quot;MyDll.dll&quot;)]
    public static extern void SetPoint(ref Point p);
}

static void Main(string[] args) {
    Program.DoSomething();
    int result = Program.Add(1, 2);

    int a = 1, b = 2;
    Program.Swap(ref a, ref b);

    Program.Point point = new Program.Point();
    point.x = 100;
    point.y = 200;
    Program.SetPoint(ref point);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>以上是大致的实现思路和流程，具体实现时需要根据自己的需求进行调整和优化。希望这些信息对你有所帮助！</p> <h3 id="用c-定义一个动态库类包含图像buffer指针，图像宽高，长度，图像格式，保存图像接口参数为图像指针对象，字符串文件名，用java-jna调用接口存图接口"><a href="#用c-定义一个动态库类包含图像buffer指针，图像宽高，长度，图像格式，保存图像接口参数为图像指针对象，字符串文件名，用java-jna调用接口存图接口" class="header-anchor">#</a> 用C++定义一个动态库类包含图像buffer指针，图像宽高，长度，图像格式，保存图像接口参数为图像指针对象，字符串文件名，用JAVA jna调用接口存图接口</h3> <p>正在为您搜索：C++、动态库类、图像buffer指针、图像宽高</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cppCopy Code// MyImage.h
#pragma once

#include &lt;string&gt;
#include &lt;cstdint&gt;

#ifdef MYIMAGE_EXPORTS
#define MYIMAGE_API __declspec(dllexport)
#else
#define MYIMAGE_API __declspec(dllimport)
#endif

class MYIMAGE_API MyImage {
public:
    MyImage(int width, int height, int length, const std::string&amp; format);
    ~MyImage();

    uint8_t* GetBuffer() const;
    int GetWidth() const;
    int GetHeight() const;
    int GetLength() const;
    std::string GetFormat() const;

    void SaveImage(const std::string&amp; filename);

private:
    uint8_t* buffer_;
    int width_;
    int height_;
    int length_;
    std::string format_;
};
cppCopy Code// MyImage.cpp
#include &quot;MyImage.h&quot;
#include &lt;fstream&gt;

MyImage::MyImage(int width, int height, int length, const std::string&amp; format)
    : width_(width), height_(height), length_(length), format_(format)
{
    buffer_ = new uint8_t[length];
}

MyImage::~MyImage()
{
    delete[] buffer_;
}

uint8_t* MyImage::GetBuffer() const
{
    return buffer_;
}

int MyImage::GetWidth() const
{
    return width_;
}

int MyImage::GetHeight() const
{
    return height_;
}

int MyImage::GetLength() const
{
    return length_;
}

std::string MyImage::GetFormat() const
{
    return format_;
}

void MyImage::SaveImage(const std::string&amp; filename)
{
    std::ofstream file(filename, std::ios::out | std::ios::binary);
    file.write(reinterpret_cast&lt;char*&gt;(buffer_), length_);
    file.close();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p>使用 JNA 调用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>javaCopy Codeimport com.sun.jna.Library;
import com.sun.jna.Native;
import com.sun.jna.Pointer;

public interface MyImageLibrary extends Library {
    MyImageLibrary INSTANCE = Native.load(&quot;MyImage.dll&quot;, MyImageLibrary.class);

    public static class MyImage extends Structure {
        public Pointer buffer;
        public int width;
        public int height;
        public int length;
        public String format;

        public MyImage(Pointer p) {
            super(p);
            read();
        }

        @Override
        protected List&lt;String&gt; getFieldOrder() {
            return Arrays.asList(new String[] { &quot;buffer&quot;, &quot;width&quot;, &quot;height&quot;, &quot;length&quot;, &quot;format&quot; });
        }
    }

    MyImage createMyImage(int width, int height, int length, String format);
    void deleteMyImage(Pointer p);
    void saveImage(Pointer pMyImage, String filename);
}
javaCopy CodeMyImageLibrary.MyImage myImage = MyImageLibrary.INSTANCE.createMyImage(640, 480, 640*480*3, &quot;RGB24&quot;);
Pointer buffer = myImage.buffer;
// Copy image data to buffer
// ...

// Save image
MyImageLibrary.INSTANCE.saveImage(myImage.getPointer(), &quot;test.rgb&quot;);

MyImageLibrary.INSTANCE.deleteMyImage(myImage.getPointer());
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>在 Java 中需要引入 JNA 的相关库，具体可参考 JNA 的官方文档。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.4da30dd0.js" defer></script><script src="/assets/js/10.cfc7b205.js" defer></script>
  </body>
</html>
