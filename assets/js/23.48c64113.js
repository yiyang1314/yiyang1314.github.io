(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{190:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),s._m(2),s._m(3),s._v(" "),s._m(4),s._v(" "),s._m(5),s._m(6),s._v(" "),s._m(7),t("p",[s._v("参考资料：")]),s._v(" "),t("ul",[t("li",[s._v("["),t("a",{attrs:{href:"https://stackoverflow.com/questions/58453674/how-to-unpack-12bit-mono12packed-number",target:"_blank",rel:"noopener noreferrer"}},[s._v("2"),t("OutboundLink")],1),s._v("]")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.bitmap",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bitmap 类 (System.Drawing)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.imaging.bitmapdata",target:"_blank",rel:"noopener noreferrer"}},[s._v("BitmapData 结构 (System.Drawing.Imaging)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.imaging",target:"_blank",rel:"noopener noreferrer"}},[s._v(".Imaging 命名空间 (System.Drawing.Imaging)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.imaging.imagecodecinfo",target:"_blank",rel:"noopener noreferrer"}},[s._v("ImageCodecInfo 类 (System.Drawing.Imaging)"),t("OutboundLink")],1)])]),s._v(" "),s._m(8),s._v(" "),s._m(9),s._m(10),s._v(" "),t("p",[s._v("参考资料：")]),s._v(" "),t("ul",[t("li",[s._v("["),t("a",{attrs:{href:"https://buffer.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("1"),t("OutboundLink")],1),s._v("]")]),s._v(" "),t("li",[s._v("["),t("a",{attrs:{href:"https://dictionary.goo.ne.jp/word/%E4%BF%9D%E5%AD%98/",target:"_blank",rel:"noopener noreferrer"}},[s._v("2"),t("OutboundLink")],1),s._v("]")]),s._v(" "),t("li",[t("a",{attrs:{href:"http://www.libtiff.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("libtiff - TIFF library and utilities"),t("OutboundLink")],1)])]),s._v(" "),s._m(11),s._v(" "),t("p",[s._v("以下是调用 C++ 动态库的示例 C# 代码，用于保存 Mono12Packed 数据为 16 位 TIFF 格式图像：")]),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._v(" "),t("p",[s._v("保存 Mono12 数据为 16 位图像的C++代码示例：")]),s._v(" "),s._m(15),t("p",[s._v("需要注意的是，上述函数中使用的 TIFF 和 JPEG 库需要自行安装并链接到项目中。同时，\n在编译 DLL 文件时需要将上述函数导出，例如：")]),s._v(" "),s._m(16),t("p",[s._v("完成 DLL 文件编译后，在 C# 项目中可以使用以下方式调用存图接口：")]),s._v(" "),s._m(17),t("p",[s._v("在 JAVA 中，可以使用 JNA（Java Native Access）库调用 C++ DLL 中的函数，具体操作方式略有不同，\n可以参考 JNA 的相关文档进行学习。")])])}),[function(){var s=this._self._c;return s("h1",{attrs:{id:"工业相机灰度图像知识扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工业相机灰度图像知识扩展"}},[this._v("#")]),this._v(" 工业相机灰度图像知识扩展")])},function(){var s=this._self._c;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"})])},function(){var s=this._self._c;return s("div",{staticClass:"language-txt line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[this._v("  邮箱：yiyangyu1314@outlook.com\n  \n  作者：易陽羽\n  \n  时间：2023-06-08\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br"),s("span",{staticClass:"line-number"},[this._v("2")]),s("br"),s("span",{staticClass:"line-number"},[this._v("3")]),s("br"),s("span",{staticClass:"line-number"},[this._v("4")]),s("br"),s("span",{staticClass:"line-number"},[this._v("5")]),s("br")])])},function(){var s=this._self._c;return s("h2",{attrs:{id:"_1-用c-把mono12packed的buffer-保存为16位的tiff-图像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-用c-把mono12packed的buffer-保存为16位的tiff-图像"}},[this._v("#")]),this._v(" 1.用C#把Mono12Packed的buffer 保存为16位的tiff 图像")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"}),s._v(" "),t("p",[s._v("使用C#中的"),t("code",[s._v("System.Drawing.Imaging")]),s._v("命名空间下的"),t("code",[s._v("Bitmap")]),s._v("、"),t("code",[s._v("BitmapData")]),s._v("和"),t("code",[s._v("Encoder")]),s._v("类将 Mono12Packed 的 buffer 保存为 16 位的 tiff 图像。\n以下是大致的代码流程：")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 假设已经将 Mono12Packed 数据读入到了 byte[] buffer 中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置图像宽度和高度（根据实际情况设置）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")])]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2560")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")])]),s._v(" height "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2160")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建一个 Bitmap 对象并锁定其内存区域以便于直接访问数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bitmap")]),s._v(" bmp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("Bitmap")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("width"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" PixelFormat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Format16bppGrayScale"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BitmapData")]),s._v(" bmpData "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("LockBits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("Rectangle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" width"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" height"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ImageLockMode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WriteOnly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PixelFormat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写入像素数据（将 Mono12Packed 转换为 16 位灰度像素）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")])]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" height"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" pRow "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("bmpData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Scan0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" bmpData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Stride"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")])]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" width"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")])]),s._v(" b1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")])]),s._v(" b2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ushort")])]),s._v(" val1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ushort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ushort")])]),s._v(" val2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ushort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" width "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ushort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pRow "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" val1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ushort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pRow "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" val2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解锁 Bitmap 对象并保存为 tiff 图像")]),s._v("\nbmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("UnlockBits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bmpData"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EncoderParameters")]),s._v(" encParams "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("EncoderParameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nencParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Param"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[s._v("EncoderParameter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Encoder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SaveFlag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("EncoderValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Flush"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nbmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Save")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"output.tiff"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ImageFormat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Tiff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" encParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("需要注意的是，上面代码中的 "),s("code",[this._v("GetEncoder")]),this._v(" 方法需要自行实现。它通常会在整个应用程序范围内使用，并将每个图像格式映射到相应的图像编码器。以下是一个简单实现：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[s._v("csharpCopy Codeprivate "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("ImageCodecInfo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ImageFormat")]),s._v(" format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ImageCodecInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v(" codecs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ImageCodecInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetImageDecoders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("foreach")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ImageCodecInfo")]),s._v(" codec "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" codecs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FormatID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Guid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" codec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])])},function(){var s=this._self._c;return s("h2",{attrs:{id:"_2-用c-将mono12packed的buffer保存为16位tiff图像的代码，并封装成动态库dll："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-用c-将mono12packed的buffer保存为16位tiff图像的代码，并封装成动态库dll："}},[this._v("#")]),this._v(" 2.用C++将Mono12Packed的buffer保存为16位tiff图像的代码，并封装成动态库dll：")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('c++Copy Code#include <fstream>\n#include <iostream>\n#include <vector>\n#include <cstdint>\n#include "tiffio.h"\n\nextern "C" {\n    __declspec(dllexport) void SaveAsTiff(uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n    {\n        // 打开TIFF文件\n        TIFF* out = TIFFOpen(path, "w");\n\n        if (out == NULL) {\n            std::cerr << "Failed to create TIFF file." << std::endl;\n            return;\n        }\n\n        // 配置TIFF文件头信息\n        TIFFSetField(out, TIFFTAG_IMAGEWIDTH, width);\n        TIFFSetField(out, TIFFTAG_IMAGELENGTH, height);\n        TIFFSetField(out, TIFFTAG_SAMPLESPERPIXEL, 1);\n        TIFFSetField(out, TIFFTAG_BITSPERSAMPLE, 16);\n        TIFFSetField(out, TIFFTAG_PHOTOMETRIC, PHOTOMETRIC_MINISBLACK);\n        TIFFSetField(out, TIFFTAG_PLANARCONFIG, PLANARCONFIG_CONTIG);\n        TIFFSetField(out, TIFFTAG_ROWSPERSTRIP, TIFFDefaultStripSize(out, width * sizeof(uint16_t)));\n\n        // 写入像素数据（将 Mono12Packed 转换为 16 位灰度像素）\n        std::vector<uint16_t> data(width * height);\n        for (uint32_t y = 0; y < height; y++)\n        {\n            for (uint32_t x = 0; x < width; x += 2)\n            {\n                uint8_t b1 = buffer[(y * width + x) / 2 * 3];\n                uint8_t b2 = buffer[(y * width + x) / 2 * 3 + 1];\n\n                uint16_t val1 = (uint16_t)((b1 << 4) | (b2 >> 4));\n                uint16_t val2 = (uint16_t)(((b2 & 0xF) << 8) | buffer[(y * width + x) / 2 * 3 + 2]);\n\n                data[y * width + x] = val1;\n                data[y * width + x + 1] = val2;\n            }\n        }\n\n        TIFFWriteEncodedStrip(out, 0, data.data(), width * height * sizeof(uint16_t));\n\n        // 关闭TIFF文件\n        TIFFClose(out);\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("代码中使用了 libtiff 库来操作 TIFF 文件，需要在项目中添加 "),s("code",[this._v("-ltiff")]),this._v(" 库链接参数。\n同时，请注意在编译动态库时添加合适的选项以确保导出函数符号。\n这个代码可以编译为 Windows 或 Linux 平台下的动态库，\n在其他 C++ 项目中引入并调用 SaveAsTiff 函数即可实现将Mono12Packed数据保存为16位tiff图像的功能。")])},function(){var s=this._self._c;return s("h2",{attrs:{id:"_3-用c-把mono12packed的buffer-保存为16位的tiff-图像，封装为动态库dll，并使用c-调用存图接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-用c-把mono12packed的buffer-保存为16位的tiff-图像，封装为动态库dll，并使用c-调用存图接口"}},[this._v("#")]),this._v(" 3.用C++ 把Mono12Packed的buffer 保存为16位的tiff 图像，封装为动态库dll，并使用C#调用存图接口")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('c#Copy Codeusing System;\nusing System.Runtime.InteropServices;\n\nnamespace SaveAsTiffDemo\n{\n    class Program\n    {\n        [DllImport("libMono12PackedToTiff.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsTiff(IntPtr buffer, uint width, uint height, string path);\n\n        static void Main(string[] args)\n        {\n            // Mono12Packed 数据（假设为 2560x2160 分辨率）\n            byte[] mono12PackedData = new byte[2560 * 2160 / 2 * 3];\n            \n            // 填充 Mono12Packed 数据（此处略去）\n            // ......\n            \n            // 将 Mono12Packed 数据传递给 C++ 动态库\n            IntPtr ptr = Marshal.AllocHGlobal(mono12PackedData.Length);\n            Marshal.Copy(mono12PackedData, 0, ptr, mono12PackedData.Length);\n\n            // 调用 C++ 存图接口\n            SaveAsTiff(ptr, 2560, 2160, "output.tif");\n\n            // 释放内存\n            Marshal.FreeHGlobal(ptr);\n        }\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])])},function(){var s=this._self._c;return s("p",[this._v("需要注意的是，C++ 动态库中的函数必须按照 C 风格进行导出，即使用 "),s("code",[this._v('extern "C" { ... }')]),this._v(" 块来\n包含函数声明，并且在调用时需要指定 "),s("code",[this._v("CallingConvention = CallingConvention.Cdecl")]),this._v(" 参数。\n同时，需要将 Mono12Packed 数据转换为 "),s("code",[this._v("IntPtr")]),this._v(" 类型的指针传递给 C++ 函数。\n完成上述代码后，在 C# 项目中添加对动态库文件的引用，并在调用前确保动态库文件已经正确部署到目标系统中即可。")])},function(){var s=this._self._c;return s("h2",{attrs:{id:"_2-用c-把mono12的buffer-保存为16位的bmp-tiff-png-raw-jpeg-文件，封装为动态库dll，并使用c-，java-jna调用存图接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-用c-把mono12的buffer-保存为16位的bmp-tiff-png-raw-jpeg-文件，封装为动态库dll，并使用c-，java-jna调用存图接口"}},[this._v("#")]),this._v(" 2.用C++ 把Mono12的buffer 保存为16位的bmp,tiff,png,raw,jpeg 文件，封装为动态库dll，并使用C#，JAVA Jna调用存图接口")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('c++Copy Code#include <cstdint>\n#include <cstring>\n#include <iostream>\n#include <fstream>\n#include "libtiff/tiffio.h"\n#include "lodepng.h"\n\n// 保存 Mono12 数据为 16 位 TIFF 格式图像\nvoid SaveAsTiff(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    // 打开 TIFF 文件并写入数据\n    TIFF* tif = TIFFOpen(path, "w");\n    TIFFSetField(tif, TIFFTAG_IMAGEWIDTH, width);\n    TIFFSetField(tif, TIFFTAG_IMAGELENGTH, height);\n    TIFFSetField(tif, TIFFTAG_SAMPLESPERPIXEL, 1);\n    TIFFSetField(tif, TIFFTAG_BITSPERSAMPLE, 16);\n    TIFFSetField(tif, TIFFTAG_ORIENTATION, ORIENTATION_TOPLEFT);\n    TIFFSetField(tif, TIFFTAG_PLANARCONFIG, PLANARCONFIG_CONTIG);\n    TIFFSetField(tif, TIFFTAG_PHOTOMETRIC, PHOTOMETRIC_MINISBLACK);\n    TIFFSetField(tif, TIFFTAG_ROWSPERSTRIP, TIFFDefaultStripSize(tif, width * sizeof(uint16_t)));\n    for (uint32_t i = 0; i < height; ++i)\n    {\n        TIFFWriteScanline(tif, (uint16_t*)(buffer + i * width), i);\n    }\n    TIFFClose(tif);\n}\n\n// 保存 Mono12 数据为 16 位 PNG 格式图像（使用 lodepng 库）\nvoid SaveAsPng(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    std::vector<uint16_t> data16(width * height);\n    for (uint32_t i = 0; i < width * height; ++i)\n    {\n        data16[i] = buffer[i] << 8;\n    }\n    std::vector<uint8_t> data8(data16.size() * 2);\n    std::memcpy(data8.data(), data16.data(), data16.size() * sizeof(uint16_t));\n    lodepng::encode(path, data8, width, height, LCT_GREY_ALPHA, 16);\n}\n\n// 保存 Mono12 数据为 16 位 RAW 格式图像\nvoid SaveAsRaw(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    std::ofstream fout(path, std::ios::binary);\n    fout.write((const char*)(buffer), width * height * sizeof(uint16_t));\n    fout.close();\n}\n\n// 保存 Mono12 数据为 16 位 JPEG 格式图像（使用 libjpeg-turbo 库）\nvoid SaveAsJpeg(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    struct jpeg_compress_struct cinfo;\n    struct jpeg_error_mgr jerr;\n    cinfo.err = jpeg_std_error(&jerr);\n    jpeg_create_compress(&cinfo);\n\n    FILE* outfile = fopen(path, "wb");\n    if (!outfile)\n    {\n        std::cerr << "Failed to open file for writing " << path << std::endl;\n        return;\n    }\n\n    jpeg_stdio_dest(&cinfo, outfile);\n    cinfo.image_width = width;\n    cinfo.image_height = height;\n    cinfo.input_components = 1;\n    cinfo.in_color_space = JCS_GRAYSCALE;\n    jpeg_set_defaults(&cinfo);\n    jpeg_set_quality(&cinfo, 90, TRUE);\n    jpeg_start_compress(&cinfo, TRUE);\n\n    JSAMPROW row_pointer[1];\n    while (cinfo.next_scanline < cinfo.image_height)\n    {\n        row_pointer[0] = (JSAMPLE*)(buffer + cinfo.next_scanline * width);\n        jpeg_write_scanlines(&cinfo, row_pointer, 1);\n    }\n    jpeg_finish_compress(&cinfo);\n    fclose(outfile);\n    jpeg_destroy_compress(&cinfo);\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('c++Copy Code// 定义 DLL 导出宏\n#ifdef MAKEDLL\n#define DLL __declspec(dllexport)\n#else\n#define DLL __declspec(dllimport)\n#endif\n\n// 导出函数声明\nextern "C" {\n    DLL void SaveAsTiff(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n    DLL void SaveAsPng(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n    DLL void SaveAsRaw(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n    DLL void SaveAsJpeg(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n}\n\n// 导出函数定义\nDLL void SaveAsTiff(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    // ...\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('c#Copy Codeusing System;\nusing System.Runtime.InteropServices;\n\nnamespace SaveAsImageDemo\n{\n    class Program\n    {\n        // 导入 DLL 中的函数\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsTiff(IntPtr buffer, uint width, uint height, string path);\n\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsPng(IntPtr buffer, uint width, uint height, string path);\n\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsRaw(IntPtr buffer, uint width, uint height, string path);\n\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsJpeg(IntPtr buffer, uint width, uint height, string path);\n\n        static void Main(string[] args)\n        {\n            // 假设 Mono12 数据存放在 byte[] buffer 中，分辨率为 2560x2160\n            byte[] buffer = new byte[2560 * 2160];\n            \n            // 将 Mono12 数据传递给 C++ DLL 中的函数\n            IntPtr ptr = Marshal.AllocHGlobal(buffer.Length);\n            Marshal.Copy(buffer, 0, ptr, buffer.Length);\n\n            // 调用 C++ DLL 中的存图接口\n            SaveAsTiff(ptr, 2560, 2160, "output.tif");\n            SaveAsPng(ptr, 2560, 2160, "output.png");\n            SaveAsRaw(ptr, 2560, 2160, "output.raw");\n            SaveAsJpeg(ptr, 2560, 2160, "output.jpg");\n\n            // 释放内存\n            Marshal.FreeHGlobal(ptr);\n        }\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])])}],!1,null,null,null);t.default=e.exports}}]);