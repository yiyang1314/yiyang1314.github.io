(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{179:function(n,s,t){"use strict";t.r(s);var a=t(0),e=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("div",{staticClass:"content"},[n._m(0),n._v(" "),s("p",[n._v("2023/5/10 00:29:45")]),n._v(" "),s("p",[n._v("正在为您搜索：C#、Mono12Packed、buffer、保存")]),n._v(" "),n._m(1),n._v(" "),n._m(2),n._m(3),n._v(" "),n._m(4),s("p",[n._v("参考资料：")]),n._v(" "),s("ul",[s("li",[n._v("["),s("a",{attrs:{href:"https://stackoverflow.com/questions/58453674/how-to-unpack-12bit-mono12packed-number",target:"_blank",rel:"noopener noreferrer"}},[n._v("2"),s("OutboundLink")],1),n._v("]")]),n._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.bitmap",target:"_blank",rel:"noopener noreferrer"}},[n._v("Bitmap 类 (System.Drawing)"),s("OutboundLink")],1)]),n._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.imaging.bitmapdata",target:"_blank",rel:"noopener noreferrer"}},[n._v("BitmapData 结构 (System.Drawing.Imaging)"),s("OutboundLink")],1)]),n._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.imaging",target:"_blank",rel:"noopener noreferrer"}},[n._v(".Imaging 命名空间 (System.Drawing.Imaging)"),s("OutboundLink")],1)]),n._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/dotnet/api/system.drawing.imaging.imagecodecinfo",target:"_blank",rel:"noopener noreferrer"}},[n._v("ImageCodecInfo 类 (System.Drawing.Imaging)"),s("OutboundLink")],1)])]),n._v(" "),n._m(5),n._v(" "),s("p",[n._v("2023/5/10 00:34:46")]),n._v(" "),s("p",[n._v("用C++ 把Mono12Packed的buffer 保存为16位的tiff 图像，封装为动态库dll")]),n._v(" "),s("p",[n._v("2023/5/10 00:35:42")]),n._v(" "),s("p",[n._v("正在为您搜索：C++、Mono12Packed、buffer、保存")]),n._v(" "),s("p",[n._v("以下是一个用C++将Mono12Packed的buffer保存为16位tiff图像的代码，并封装成动态库dll：")]),n._v(" "),n._m(6),n._m(7),n._v(" "),s("p",[n._v("这个代码可以编译为 Windows 或 Linux 平台下的动态库，在其他 C++ 项目中引入并调用 SaveAsTiff 函数即可实现将Mono12Packed数据保存为16位tiff图像的功能。")]),n._v(" "),s("p",[n._v("参考资料：")]),n._v(" "),s("ul",[s("li",[n._v("["),s("a",{attrs:{href:"https://buffer.com/",target:"_blank",rel:"noopener noreferrer"}},[n._v("1"),s("OutboundLink")],1),n._v("]")]),n._v(" "),s("li",[n._v("["),s("a",{attrs:{href:"https://dictionary.goo.ne.jp/word/%E4%BF%9D%E5%AD%98/",target:"_blank",rel:"noopener noreferrer"}},[n._v("2"),s("OutboundLink")],1),n._v("]")]),n._v(" "),s("li",[s("a",{attrs:{href:"http://www.libtiff.org/",target:"_blank",rel:"noopener noreferrer"}},[n._v("libtiff - TIFF library and utilities"),s("OutboundLink")],1)])]),n._v(" "),n._m(8),n._v(" "),s("p",[n._v("2023/5/10 00:37:49")]),n._v(" "),s("p",[n._v("用C++ 把Mono12Packed的buffer 保存为16位的tiff 图像，封装为动态库dll，并使用C#调用存图接口")]),n._v(" "),s("p",[n._v("2023/5/10 00:38:30")]),n._v(" "),s("p",[n._v("正在为您搜索：C++、Mono12Packed、buffer、保存")]),n._v(" "),s("p",[n._v("以下是调用 C++ 动态库的示例 C# 代码，用于保存 Mono12Packed 数据为 16 位 TIFF 格式图像：")]),n._v(" "),n._m(9),n._m(10),n._v(" "),s("p",[n._v("完成上述代码后，在 C# 项目中添加对动态库文件的引用，并在调用前确保动态库文件已经正确部署到目标系统中即可。")]),n._v(" "),n._m(11),n._v(" "),s("p",[n._v("2023/5/10 00:42:44")]),n._v(" "),s("p",[n._v("用C++ 把Mono12的buffer 保存为16位的bmp,tiff,png,raw,jpeg 文件，封装为动态库dll，并使用C#，JAVA Jna调用存图接口")]),n._v(" "),s("p",[n._v("2023/5/10 00:44:46")]),n._v(" "),s("p",[n._v("正在为您搜索：C++、Mono12、buffer、16位")]),n._v(" "),s("p",[n._v("保存 Mono12 数据为 16 位图像的C++代码示例：")]),n._v(" "),n._m(12),s("p",[n._v("需要注意的是，上述函数中使用的 TIFF 和 JPEG 库需要自行安装并链接到项目中。同时，在编译 DLL 文件时需要将上述函数导出，例如：")]),n._v(" "),n._m(13),s("p",[n._v("完成 DLL 文件编译后，在 C# 项目中可以使用以下方式调用存图接口：")]),n._v(" "),n._m(14),s("p",[n._v("在 JAVA 中，可以使用 JNA（Java Native Access）库调用 C++ DLL 中的函数，具体操作方式略有不同，可以参考 JNA 的相关文档进行学习。")])])}),[function(){var n=this._self._c;return n("ol",[n("li",[this._v("用C#把Mono12Packed的buffer 保存为16位的tiff 图像")])])},function(){var n=this,s=n._self._c;return s("p",[n._v("您好，可以使用C#中的"),s("code",[n._v("System.Drawing.Imaging")]),n._v("命名空间下的"),s("code",[n._v("Bitmap")]),n._v("、"),s("code",[n._v("BitmapData")]),n._v("和"),s("code",[n._v("Encoder")]),n._v("类将 Mono12Packed 的 buffer 保存为 16 位的 tiff 图像。以下是大致的代码流程：")])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('csharpCopy Code// 假设已经将 Mono12Packed 数据读入到了 byte[] buffer 中\n\n// 设置图像宽度和高度（根据实际情况设置）\nint width = 2560;\nint height = 2160;\n\n// 创建一个 Bitmap 对象并锁定其内存区域以便于直接访问数据\nBitmap bmp = new Bitmap(width, height, PixelFormat.Format16bppGrayScale);\nBitmapData bmpData = bmp.LockBits(new Rectangle(0, 0, width, height), ImageLockMode.WriteOnly, bmp.PixelFormat);\n\n// 写入像素数据（将 Mono12Packed 转换为 16 位灰度像素）\nfor (int y = 0; y < height; y++)\n{\n    byte* pRow = (byte*)bmpData.Scan0 + y * bmpData.Stride;\n    for (int x = 0; x < width; x += 2)\n    {\n        byte b1 = buffer[(y * width + x) / 2 * 3];\n        byte b2 = buffer[(y * width + x) / 2 * 3 + 1];\n\n        ushort val1 = (ushort)((b1 << 4) | (b2 >> 4));\n        ushort val2 = (ushort)(((b2 & 0xF) << 8) | buffer[(y * width + x) / 2 * 3 + 2]);\n        *(ushort*)(pRow + x * 2) = val1;\n        *(ushort*)(pRow + x * 2 + 2) = val2;\n    }\n}\n\n// 解锁 Bitmap 对象并保存为 tiff 图像\nbmp.UnlockBits(bmpData);\nEncoderParameters encParams = new EncoderParameters(1);\nencParams.Param[0] = new EncoderParameter(Encoder.SaveFlag, (long)EncoderValue.Flush);\nbmp.Save("output.tiff", GetEncoder(ImageFormat.Tiff), encParams);\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br")])])},function(){var n=this._self._c;return n("p",[this._v("需要注意的是，上面代码中的 "),n("code",[this._v("GetEncoder")]),this._v(" 方法需要自行实现。它通常会在整个应用程序范围内使用，并将每个图像格式映射到相应的图像编码器。以下是一个简单实现：")])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("csharpCopy Codeprivate static ImageCodecInfo GetEncoder(ImageFormat format)\n{\n    ImageCodecInfo[] codecs = ImageCodecInfo.GetImageDecoders();\n\n    foreach (ImageCodecInfo codec in codecs)\n    {\n        if (codec.FormatID == format.Guid)\n        {\n            return codec;\n        }\n    }\n\n    return null;\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br")])])},function(){var n=this._self._c;return n("p",[n("img",{attrs:{src:"https://chat.jinshutuan.com/assets/avatar-ceeb03f6.jpg",alt:"img"}})])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('c++Copy Code#include <fstream>\n#include <iostream>\n#include <vector>\n#include <cstdint>\n#include "tiffio.h"\n\nextern "C" {\n    __declspec(dllexport) void SaveAsTiff(uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n    {\n        // 打开TIFF文件\n        TIFF* out = TIFFOpen(path, "w");\n\n        if (out == NULL) {\n            std::cerr << "Failed to create TIFF file." << std::endl;\n            return;\n        }\n\n        // 配置TIFF文件头信息\n        TIFFSetField(out, TIFFTAG_IMAGEWIDTH, width);\n        TIFFSetField(out, TIFFTAG_IMAGELENGTH, height);\n        TIFFSetField(out, TIFFTAG_SAMPLESPERPIXEL, 1);\n        TIFFSetField(out, TIFFTAG_BITSPERSAMPLE, 16);\n        TIFFSetField(out, TIFFTAG_PHOTOMETRIC, PHOTOMETRIC_MINISBLACK);\n        TIFFSetField(out, TIFFTAG_PLANARCONFIG, PLANARCONFIG_CONTIG);\n        TIFFSetField(out, TIFFTAG_ROWSPERSTRIP, TIFFDefaultStripSize(out, width * sizeof(uint16_t)));\n\n        // 写入像素数据（将 Mono12Packed 转换为 16 位灰度像素）\n        std::vector<uint16_t> data(width * height);\n        for (uint32_t y = 0; y < height; y++)\n        {\n            for (uint32_t x = 0; x < width; x += 2)\n            {\n                uint8_t b1 = buffer[(y * width + x) / 2 * 3];\n                uint8_t b2 = buffer[(y * width + x) / 2 * 3 + 1];\n\n                uint16_t val1 = (uint16_t)((b1 << 4) | (b2 >> 4));\n                uint16_t val2 = (uint16_t)(((b2 & 0xF) << 8) | buffer[(y * width + x) / 2 * 3 + 2]);\n\n                data[y * width + x] = val1;\n                data[y * width + x + 1] = val2;\n            }\n        }\n\n        TIFFWriteEncodedStrip(out, 0, data.data(), width * height * sizeof(uint16_t));\n\n        // 关闭TIFF文件\n        TIFFClose(out);\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br")])])},function(){var n=this._self._c;return n("p",[this._v("代码中使用了 libtiff 库来操作 TIFF 文件，需要在项目中添加 "),n("code",[this._v("-ltiff")]),this._v(" 库链接参数。同时，请注意在编译动态库时添加合适的选项以确保导出函数符号。")])},function(){var n=this._self._c;return n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/Chanzhaoyu/chatgpt-web/main/src/assets/avatar.jpg",alt:"img"}})])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('c#Copy Codeusing System;\nusing System.Runtime.InteropServices;\n\nnamespace SaveAsTiffDemo\n{\n    class Program\n    {\n        [DllImport("libMono12PackedToTiff.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsTiff(IntPtr buffer, uint width, uint height, string path);\n\n        static void Main(string[] args)\n        {\n            // Mono12Packed 数据（假设为 2560x2160 分辨率）\n            byte[] mono12PackedData = new byte[2560 * 2160 / 2 * 3];\n            \n            // 填充 Mono12Packed 数据（此处略去）\n            // ......\n            \n            // 将 Mono12Packed 数据传递给 C++ 动态库\n            IntPtr ptr = Marshal.AllocHGlobal(mono12PackedData.Length);\n            Marshal.Copy(mono12PackedData, 0, ptr, mono12PackedData.Length);\n\n            // 调用 C++ 存图接口\n            SaveAsTiff(ptr, 2560, 2160, "output.tif");\n\n            // 释放内存\n            Marshal.FreeHGlobal(ptr);\n        }\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br")])])},function(){var n=this._self._c;return n("p",[this._v("需要注意的是，C++ 动态库中的函数必须按照 C 风格进行导出，即使用 "),n("code",[this._v('extern "C" { ... }')]),this._v(" 块来包含函数声明，并且在调用时需要指定 "),n("code",[this._v("CallingConvention = CallingConvention.Cdecl")]),this._v(" 参数。同时，需要将 Mono12Packed 数据转换为 "),n("code",[this._v("IntPtr")]),this._v(" 类型的指针传递给 C++ 函数。")])},function(){var n=this._self._c;return n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/Chanzhaoyu/chatgpt-web/main/src/assets/avatar.jpg",alt:"img"}})])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('c++Copy Code#include <cstdint>\n#include <cstring>\n#include <iostream>\n#include <fstream>\n#include "libtiff/tiffio.h"\n#include "lodepng.h"\n\n// 保存 Mono12 数据为 16 位 TIFF 格式图像\nvoid SaveAsTiff(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    // 打开 TIFF 文件并写入数据\n    TIFF* tif = TIFFOpen(path, "w");\n    TIFFSetField(tif, TIFFTAG_IMAGEWIDTH, width);\n    TIFFSetField(tif, TIFFTAG_IMAGELENGTH, height);\n    TIFFSetField(tif, TIFFTAG_SAMPLESPERPIXEL, 1);\n    TIFFSetField(tif, TIFFTAG_BITSPERSAMPLE, 16);\n    TIFFSetField(tif, TIFFTAG_ORIENTATION, ORIENTATION_TOPLEFT);\n    TIFFSetField(tif, TIFFTAG_PLANARCONFIG, PLANARCONFIG_CONTIG);\n    TIFFSetField(tif, TIFFTAG_PHOTOMETRIC, PHOTOMETRIC_MINISBLACK);\n    TIFFSetField(tif, TIFFTAG_ROWSPERSTRIP, TIFFDefaultStripSize(tif, width * sizeof(uint16_t)));\n    for (uint32_t i = 0; i < height; ++i)\n    {\n        TIFFWriteScanline(tif, (uint16_t*)(buffer + i * width), i);\n    }\n    TIFFClose(tif);\n}\n\n// 保存 Mono12 数据为 16 位 PNG 格式图像（使用 lodepng 库）\nvoid SaveAsPng(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    std::vector<uint16_t> data16(width * height);\n    for (uint32_t i = 0; i < width * height; ++i)\n    {\n        data16[i] = buffer[i] << 8;\n    }\n    std::vector<uint8_t> data8(data16.size() * 2);\n    std::memcpy(data8.data(), data16.data(), data16.size() * sizeof(uint16_t));\n    lodepng::encode(path, data8, width, height, LCT_GREY_ALPHA, 16);\n}\n\n// 保存 Mono12 数据为 16 位 RAW 格式图像\nvoid SaveAsRaw(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    std::ofstream fout(path, std::ios::binary);\n    fout.write((const char*)(buffer), width * height * sizeof(uint16_t));\n    fout.close();\n}\n\n// 保存 Mono12 数据为 16 位 JPEG 格式图像（使用 libjpeg-turbo 库）\nvoid SaveAsJpeg(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    struct jpeg_compress_struct cinfo;\n    struct jpeg_error_mgr jerr;\n    cinfo.err = jpeg_std_error(&jerr);\n    jpeg_create_compress(&cinfo);\n\n    FILE* outfile = fopen(path, "wb");\n    if (!outfile)\n    {\n        std::cerr << "Failed to open file for writing " << path << std::endl;\n        return;\n    }\n\n    jpeg_stdio_dest(&cinfo, outfile);\n    cinfo.image_width = width;\n    cinfo.image_height = height;\n    cinfo.input_components = 1;\n    cinfo.in_color_space = JCS_GRAYSCALE;\n    jpeg_set_defaults(&cinfo);\n    jpeg_set_quality(&cinfo, 90, TRUE);\n    jpeg_start_compress(&cinfo, TRUE);\n\n    JSAMPROW row_pointer[1];\n    while (cinfo.next_scanline < cinfo.image_height)\n    {\n        row_pointer[0] = (JSAMPLE*)(buffer + cinfo.next_scanline * width);\n        jpeg_write_scanlines(&cinfo, row_pointer, 1);\n    }\n    jpeg_finish_compress(&cinfo);\n    fclose(outfile);\n    jpeg_destroy_compress(&cinfo);\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br")])])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('c++Copy Code// 定义 DLL 导出宏\n#ifdef MAKEDLL\n#define DLL __declspec(dllexport)\n#else\n#define DLL __declspec(dllimport)\n#endif\n\n// 导出函数声明\nextern "C" {\n    DLL void SaveAsTiff(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n    DLL void SaveAsPng(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n    DLL void SaveAsRaw(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n    DLL void SaveAsJpeg(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path);\n}\n\n// 导出函数定义\nDLL void SaveAsTiff(const uint8_t* buffer, uint32_t width, uint32_t height, const char* path)\n{\n    // ...\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br")])])},function(){var n=this,s=n._self._c;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('c#Copy Codeusing System;\nusing System.Runtime.InteropServices;\n\nnamespace SaveAsImageDemo\n{\n    class Program\n    {\n        // 导入 DLL 中的函数\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsTiff(IntPtr buffer, uint width, uint height, string path);\n\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsPng(IntPtr buffer, uint width, uint height, string path);\n\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsRaw(IntPtr buffer, uint width, uint height, string path);\n\n        [DllImport("SaveAsImage.dll", CallingConvention = CallingConvention.Cdecl)]\n        public static extern void SaveAsJpeg(IntPtr buffer, uint width, uint height, string path);\n\n        static void Main(string[] args)\n        {\n            // 假设 Mono12 数据存放在 byte[] buffer 中，分辨率为 2560x2160\n            byte[] buffer = new byte[2560 * 2160];\n            \n            // 将 Mono12 数据传递给 C++ DLL 中的函数\n            IntPtr ptr = Marshal.AllocHGlobal(buffer.Length);\n            Marshal.Copy(buffer, 0, ptr, buffer.Length);\n\n            // 调用 C++ DLL 中的存图接口\n            SaveAsTiff(ptr, 2560, 2160, "output.tif");\n            SaveAsPng(ptr, 2560, 2160, "output.png");\n            SaveAsRaw(ptr, 2560, 2160, "output.raw");\n            SaveAsJpeg(ptr, 2560, 2160, "output.jpg");\n\n            // 释放内存\n            Marshal.FreeHGlobal(ptr);\n        }\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br")])])}],!1,null,null,null);s.default=e.exports}}]);